@model SFA.DAS.ApprenticeApp.Pwa.ViewModels.TaskViewModelBase

<div class="govuk-form-group govuk-character-count" data-module="govuk-character-count" data-maxlength="150" data-threshold="85">
    <label class="govuk-label" asp-for="@Model.Task.Title">
        Task name
    </label>
    <div class="govuk-error-message" id="Task_Title-error"></div>
    <input class="govuk-input govuk-js-character-count" name="title" type="text" asp-for="@Model.Task.Title"
           aria-describedby="Task_Title-info">
    <div id="Task_Title-info" class="govuk-hint govuk-character-count__message">
        You can enter up to 150 characters
    </div>
</div>

<div class="govuk-form-group govuk-character-count" data-module="govuk-character-count" data-maxlength="1000" data-threshold="85">
    <label class="govuk-label" for="note">
        Note <span class="govuk-!-font-weight-regular">(optional)</span>
    </label>
    <div class="note-error form-error govuk-hint"></div>
    <textarea class="govuk-textarea govuk-js-character-count" id="note" name="note" rows="5"
              aria-describedby="note-info" value="@Model.Task.Note">@Model.Task.Note</textarea>
    <div id="note-info" class="govuk-hint govuk-character-count__message">
        You can enter up to 1000 characters
    </div>
</div>

@{
    var dueDateValue = Model.Task.DueDate.GetValueOrDefault();
    var hasDate = Model.Task.DueDate != null;
}
<div class="govuk-form-group" id="date-group">
    <fieldset class="govuk-fieldset" role="group" aria-describedby="date-error">
        <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">
            Date
        </legend>
        <div class="govuk-error-message" id="date-error"></div>
        <div class="govuk-date-input" id="duedate">
            <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                    <label class="govuk-label govuk-date-input__label govuk-!-font-weight-regular" for="duedate-day">Day</label>
                    <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="duedate-day"
                           name="duedate-day" type="text" inputmode="numeric"
                           value="@(hasDate ? dueDateValue.Day.ToString() : "")">
                </div>
            </div>
            <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                    <label class="govuk-label govuk-date-input__label govuk-!-font-weight-regular" for="duedate-month">Month</label>
                    <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="duedate-month"
                           name="duedate-month" type="text" inputmode="numeric"
                           value="@(hasDate ? dueDateValue.Month.ToString() : "")">
                </div>
            </div>
            <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                    <label class="govuk-label govuk-date-input__label govuk-!-font-weight-regular" for="duedate-year">Year</label>
                    <input class="govuk-input govuk-date-input__input govuk-input--width-4" id="duedate-year"
                           name="duedate-year" type="text" inputmode="numeric"
                           value="@(hasDate ? dueDateValue.Year.ToString() : "")">
                </div>
            </div>
        </div>
    </fieldset>
    <input type="hidden" id="duedate-hidden" name="duedate" value="@(hasDate ? dueDateValue.ToString("yyyy-MM-dd") : "")">
</div>

<div class="govuk-form-group">
    <label class="govuk-label" for="time">
        Time
    </label>
    <div class="govuk-error-message" id="time-error"></div>
    @if (Model.StatusId == 0)
    {
        <input class="govuk-input govuk-!-width-one-half" id="time" name="time" type="time"
               value="@(Model.Task.DueDate == null ? "" : Model.Task.DueDate.GetValueOrDefault().ToString("HH:mm"))">
    }
    else
    {
        <input class="govuk-input govuk-!-width-one-half" id="time" name="time" type="time"
               value="@(Model.Task.CompletionDateTime == null ? "" : Model.Task.CompletionDateTime.GetValueOrDefault().ToString("HH:mm"))">
    }
</div>

@{
    var timeHours = Model.Task.DueDate.GetValueOrDefault().ToString("HH");
    var timeMinutes = Model.Task.DueDate.GetValueOrDefault().ToString("mm");
    var timeInMinutes = (Convert.ToInt32(timeHours) * 60) + Convert.ToInt32(timeMinutes);
    var reminderValue = Model.Task.ReminderValue;
    var isCustomReminder = reminderValue != 0 && reminderValue != 60 && reminderValue != 1440 && reminderValue != 0 && reminderValue > 0;
    var customDays = reminderValue / 1440;
    var customTime = reminderValue % 1440;
    if (customTime > (1440 / 2))
    {
        customDays++;
    }
    customTime = timeInMinutes - customTime;
    if (customTime < 0)
    {
        customTime = 1440 + customTime;
    }
    var customHours = customTime / 60;
    var customMinutes = customTime % 60;
    var customTimeFormatted = $"{customHours:00}:{customMinutes:00}";

    if (Model.StatusId != 1)
    {
        <div class="govuk-form-group">
            <fieldset class="govuk-fieldset">
                <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">Reminder</legend>
                <div class="govuk-radios govuk-radios--small" data-module="govuk-radios">
                    <div class="govuk-radios__item">
                        <input class="govuk-radios__input task-reminder" id="ReminderValueNone" name="ReminderValue"
                               type="radio" value="">
                        <label class="govuk-label govuk-radios__label" for="ReminderValueNone">
                            None
                        </label>
                    </div>
                    <div class="govuk-radios__item">
                        <input class="govuk-radios__input task-reminder" id="ReminderValueZero" name="ReminderValue"
                               type="radio" value="0" checked="@(Model.Task.ReminderValue == 0)">
                        <label class="govuk-label govuk-radios__label" for="ReminderValueZero">
                            At the time of activity
                        </label>
                    </div>
                    <div class="govuk-radios__item">
                        <input class="govuk-radios__input task-reminder" id="ReminderValueSixty" name="ReminderValue"
                               type="radio" value="60" checked="@(Model.Task.ReminderValue == 60)">
                        <label class="govuk-label govuk-radios__label" for="ReminderValueSixty">
                            1 hour before
                        </label>
                    </div>
                    <div class="govuk-radios__item">
                        <input class="govuk-radios__input task-reminder" id="ReminderValueOneDay" name="ReminderValue"
                               type="radio" value="1440" checked="@(Model.Task.ReminderValue == 1440)">
                        <label class="govuk-label govuk-radios__label" for="ReminderValueOneDay">
                            1 day before
                        </label>
                    </div>
                    <div class="govuk-radios__item">
                        <input class="govuk-radios__input task-reminder" id="ReminderChoose" name="ReminderValue" type="radio"
                               value="" checked="@isCustomReminder" data-aria-controls="custom-reminder">
                        <label class="govuk-label govuk-radios__label" for="ReminderChoose">
                            Custom
                        </label>
                    </div>
                    <div class="govuk-radios__conditional govuk-radios__conditional--hidden" id="custom-reminder">
                        
                        
                        <fieldset class="govuk-fieldset">
                            <legend class="govuk-fieldset__legend">Choose a day and time for the reminder</legend>
                            <div class="govuk-form-group--flex-row">
                                <label class="govuk-visually-hidden" for="reminder-length">Select date for reminder</label>
                                <input class="govuk-input" id="reminder-length" name="reminder-length" type="number" value="@customDays" />
                                <label class="govuk-visually-hidden" for="reminder-unit">Day or week</label>
                                <select class="app-select" id="reminder-unit" name="reminder-unit">
                                    <option value="day">Day(s)</option>
                                    <option value="week">Week(s)</option>
                                </select>
                                <span class="govuk-body govuk-!-margin-bottom-0">before</span>
                            </div>
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-!-font-weight-regular" for="reminder-time">Select a time <span class="govuk-visually-hidden">for the reminder</span></label>
                                <input class="govuk-input" id="reminder-time" name="reminder-time" type="time" value="@customTimeFormatted" />
                            </div>
                        </fieldset>
                        
                    </div>
            </fieldset>
        </div>
    }
}






<div class="govuk-form-group">
    <p class="govuk-label">
        Link knowledge, skills and behaviours (KSBs)
    </p>
    <button class="govuk-button--field" id="ksb-popup-btn" data-id="@Model.Task.TaskId">
        Select KSBs this task will help you gain
        <span class="govuk-button--field-icon"></span>
    </button>
</div>
