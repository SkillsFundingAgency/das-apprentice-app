<script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

<script type="text/javascript">
    $(document).ready(function () {

        $('#tasks-todo__tasks').load('@Url.Action("ToDoTasks", "Tasks")', function () {
            $('#tasks-done__tasks').load('@Url.Action("DoneTasks", "Tasks")');
        });

        $(".post-form").click(function (e) {
            $(".form").submit();
        });

        $('body').on('click', '.delete-task', function (e) {
            e.preventDefault()
            if (confirm('Are you sure you want to delete this task?')) {
                var taskId = $(this).siblings('.taskId').val();
                $(this).closest('.app-card').slideUp("slow", function () { $(this).remove(); checkTaskCount(); });

                var taskId = $('.taskId').val();
                $.ajax({
                    type: "DELETE",
                    url: '@Url.Action("DeleteApprenticeTask", "Tasks")',
                    data: { taskId: taskId },
                    dataType: "json"
                });

                return false;
            }
        });

        $('body').on('click', '.share-link', function (e) {
            if (navigator.share) {
                navigator.share({
                    title: $(this).siblings('.share-title').val(),
                    text: $(this).siblings('.share-note').val()
                })
                    .then(() => console.log('Shared successfully'))
                    .catch((error) => console.error('Sharing failed:', error));
            }
        });

        $('body').on('click', '.move-done', function (e) {
            e.preventDefault();
            var taskId = $(this).siblings('.taskId').val();
            $(this).closest('.app-card').slideUp("slow", function () { $(this).remove(); checkTaskCount(); });

            $.ajax({
                type: "GET",
                url: '@Url.Action("ChangeTaskStatus", "Tasks")',
                data: { taskId: taskId, statusId: 1 },
                dataType: "json",
                complete: () => { $('#tasks-done__tasks').load('@Url.Action("DoneTasks", "Tasks")'); }
            });

            return false;
        });

        $('body').on('click', '.move-todo', function (e) {
            e.preventDefault();
            var taskId = $(this).siblings('.taskId').val();
            $(this).closest('.app-card').slideUp("slow", function () { $(this).remove(); checkTaskCount(); });

            $.ajax({
                type: "GET",
                url: '@Url.Action("ChangeTaskStatus", "Tasks")',
                data: { taskId: taskId, statusId: 0 },
                dataType: "json",
                complete: () => { $('#tasks-todo__tasks').load('@Url.Action("ToDoTasks", "Tasks")'); }
            });

            return false;
        });

        function checkTaskCount() {
            if ($('.app-card').length == 0) {
                $('#tasks-display').hide().load('@Url.Action("TasksNotStarted", "Tasks")').fadeIn('500');
            }
        }

        // add / edit tasks popup
        $(".add-btn").click(function (e) {
            var status = $(this).attr("data-status-id");
            var addUrl = '@Url.Action("Add", "Tasks")?status=' + status;

            $('#add-edit-wrapper').show();
            $('#add-edit-wrapper').load(addUrl, function () {
                $("html, body").animate({ scrollTop: 0 }, "slow");
                // make height to the window
                $('.add-edit-content-area').height($('.app-container').height() - 100);
            });


        });

        $('body').on('click', '.edit-btn', function (e) {
            $('#add-edit-wrapper').show();
            var taskId = $(this).attr("data-id");
            var status = $(this).attr("data-status") || 0;
            var editUrl = '@Url.Action("Edit", "Tasks")/' + taskId + '?status=' + status;


            $('#add-edit-wrapper').load(editUrl, function () {

                $("html, body").animate({ scrollTop: 0 }, "slow");

                // make height to the window
                $('.add-edit-content-area').height($('.app-container').height() - 100);
            });

        });

        $('body').on('click', '.post-form', function (e) {
            $(".form").submit();
        });

    });
</script>