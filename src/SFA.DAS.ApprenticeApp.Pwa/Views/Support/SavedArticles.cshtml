@model SFA.DAS.ApprenticeApp.Pwa.ViewModels.SupportArticlesPageModel

<div class="govuk-accordion" data-module="govuk-accordion" id="accordion-default">

    <h1 class="govuk-heading-xl">Your saved articles</h1>
    <h2><a asp-controller="Support" asp-action="Index" class="app-nav__link">Back</a></h2>

    @foreach (var item in Model.Articles.Where(x => x.Heading != null))
    {
        <div class="govuk-accordion__section" id="accordion-@item.Sys.Id">
            <div class="govuk-accordion__section-header">
                <h2 class="govuk-accordion__section-heading">
                    <span class="govuk-accordion__section-button" id="accordion-default-heading-1">

                        <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg"
                             xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 15 24"
                             class="icon icon--s">
                            <path d="M12,12V2.4h1.2V0H1.2v2.4h1.2v9.6l-2.4,2.4v2.4h6.2v7.2h1.9v-7.2h6.2v-2.4l-2.4-2.4Z"
                                  fill="currentColor" />
                        </svg>

                        @item.Heading

                    </span>
                </h2>
            </div>
            <div id="accordion-default-content-@item.Sys.Id" class="govuk-accordion__section-content">
                @if (item.Content != null)
                {
                    <p class="govuk-body">@Html.Raw(Markdig.Markdown.ToHtml(item.Content.ToString()))</p>
                }
                else
                {
                    <p class="govuk-body">No content was found for this article</p>
                }

                <hr />

                @if (Model.ApprenticeArticles.Any(x => x.EntryId == item.Sys.Id && x.IsSaved == true))
                {
                    <i class="fa-solid fa-bookmark unsave"></i>
                    <hr />
                }

                @if (Model.ApprenticeArticles.Any(x => x.EntryId == item.Sys.Id && x.IsSaved == false))
                {
                    <i class="fa-regular fa-bookmark save"></i>
                    <hr />
                }

                @if (Model.ApprenticeArticles.Any(x => x.EntryId == item.Sys.Id && x.IsSaved == null))
                {
                    <i class="fa-regular fa-bookmark save"></i>
                    <hr />
                }

                @if (Model.ApprenticeArticles.Any(x => x.EntryId == item.Sys.Id && x.LikeStatus == true))
                {
                    <i class="fa-solid fa-thumbs-up thumbs-up"></i>
                    <i class="fa-regular fa-thumbs-down thumbs-down"></i>
                    <hr />
                }

                @if (Model.ApprenticeArticles.Any(x => x.EntryId == item.Sys.Id && x.LikeStatus == false))
                {
                    <i class="fa-regular fa-thumbs-up thumbs-up"></i>
                    <i class="fa-solid fa-thumbs-down thumbs-down"></i>
                    <hr />
                }

                @if (Model.ApprenticeArticles.Any(x => x.EntryId == item.Sys.Id && x.LikeStatus == null))
                {
                    <i class="fa-regular fa-thumbs-up thumbs-up"></i>
                    <i class="fa-regular fa-thumbs-down thumbs-down"></i>
                    <hr />
                }


                @if (Model.ApprenticeArticles.Where(x => x.EntryId == item.Sys.Id).Count() == 0)
                {
                    <i class="fa-regular fa-bookmark save"></i>

                    <hr />

                    <i class="fa-regular fa-thumbs-up thumbs-up"></i>
                    <i class="fa-regular fa-thumbs-down thumbs-down"></i>

                    <hr />
                }

                <br /><a class="share-btn"><i class="fa-solid fa-arrow-up-from-bracket"></i></a>

                <input class="article-title" type="hidden" value="@item.Heading" />
                <input class="entryid" type="hidden" value="@item.Sys.Id" />

            </div>
        </div>
    }
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<style>
    i:hover {
        cursor: pointer;
    }
</style>

<script type="text/javascript">

    $(document).ready(function ()
    {
        $('.thumbs-up').on('click', function () {
            $(this).removeClass('fa-regular').addClass('fa-solid');
            $(this).next('i').removeClass('fa-solid').addClass('fa-regular');

            $.ajax({
            type: "GET",
            url: '@Url.Action("AddOrUpdateApprenticeArticle", "Support")',
            data: { entryId: $(this).siblings('.entryid').val(), likeStatus: "true" },
            dataType: "json",
            contentType: "application/json"
            });
            return false;
        });

        $('.thumbs-down').on('click', function () {
            $(this).removeClass('fa-regular').addClass('fa-solid');
            $(this).prev('i').removeClass('fa-solid').addClass('fa-regular');

            $.ajax({
            type: "GET",
            url: '@Url.Action("AddOrUpdateApprenticeArticle", "Support")',
            data: { entryId: $(this).siblings('.entryid').val(), likeStatus: "false" },
            dataType: "json",
            contentType: "application/json"
            });
            return false;
        });

        $('.save').on('click', function () {
            $(this).removeClass('fa-regular').addClass('fa-solid');

            $.ajax({
            type: "GET",
            url: '@Url.Action("AddOrUpdateApprenticeArticle", "Support")',
            data: { entryId: $(this).siblings('.entryid').val(), isSaved: "true" },
            dataType: "json",
            contentType: "application/json"
            });
            return false;
        });

        $('.unsave').on('click', function () {
            var accordionId = $(this).siblings('.entryid').val();
            $.ajax({
            type: "GET",
            url: '@Url.Action("AddOrUpdateApprenticeArticle", "Support")',
            data: { entryId: $(this).siblings('.entryid').val(), isSaved: "false" },
            beforeSend: function () {
                return confirm("Are you sure you want to remove this from your saved articles?");
            },
            complete: function () {
                $('#accordion-' + accordionId).hide();
            },
            dataType: "json",
            contentType: "application/json"
            });

            return false;
        });

        $('.share-btn').on('click', function () {
            if (navigator.share)
            {
                navigator.share({
                    title: $(this).siblings('.article-title').val(),
                    text: $(this).siblings('.govuk-body').text(),
                    url: window.location.href,
                })
                    .then(() => console.log('Shared successfully'))
                    .catch((error) => console.error('Sharing failed:', error));
            }
            else
            {
                // If Web Share API is not supported, hide the button
                // const shareButton = document.getElementById('share-btn');
                //shareButton.style.display = 'none';
            }
        });
    });
</script>